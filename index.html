<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    text-align: center;
  }
  h1 {
    margin-top: 20px;
  }
  button {
    margin: 10px;
  }
</style>
<title>Task reminder</title>
</head>
<body>
<h1>Task reminder</h1>
<button id="startRecording">Start Recording</button>
<button id="stopRecording" disabled>Stop Recording</button>
<br><br>
<button id="playLoop">Play Reminder Loop</button>
<button id="stopLoop" style="display:none;">Stop Reminder</button>

<script>
const startRecordingBtn = document.getElementById('startRecording');
const stopRecordingBtn = document.getElementById('stopRecording');
const playLoopBtn = document.getElementById('playLoop');
const stopLoopBtn = document.getElementById('stopLoop');

let mediaRecorder;
let recordedChunks = [];
let isLoopPlaying = false;
let loopIntervalId;

startRecordingBtn.addEventListener('click', async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);
  mediaRecorder.ondataavailable = e => {
    if (e.data.size > 0) {
      recordedChunks.push(e.data);
    }
  };
  mediaRecorder.onstop = () => {
    const blob = new Blob(recordedChunks, { type: 'audio/wav' });
    const audioUrl = URL.createObjectURL(blob);
    playLoopBtn.disabled = false;
    stopLoopBtn.style.display = 'inline-block';
    playLoop(audioUrl);
  };
  mediaRecorder.start();
  startRecordingBtn.disabled = true;
  stopRecordingBtn.disabled = false;
});

stopRecordingBtn.addEventListener('click', () => {
  mediaRecorder.stop();
  startRecordingBtn.disabled = false;
  stopRecordingBtn.disabled = true;
});

playLoopBtn.addEventListener('click', () => {
  isLoopPlaying = true;
  playLoopBtn.disabled = true;
  stopLoopBtn.style.display = 'inline-block';
});

stopLoopBtn.addEventListener('click', () => {
  clearTimeout(loopIntervalId);
  isLoopPlaying = false;
  playLoopBtn.disabled = false;
  stopLoopBtn.style.display = 'none';
});

function playLoop(audioUrl) {
  const audio = new Audio(audioUrl);
  audio.play();
  audio.addEventListener('ended', () => {
    loopIntervalId = setTimeout(() => {
      if (isLoopPlaying) {
        playLoop(audioUrl);
      }
    }, 8000); // 8 seconds pause at the end of playback
  });
}
</script>
</body>
</html>
