<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sound Reminder App</title>
</head>
<body>
<h1>Sound Reminder App</h1>
<button id="startRecording">Start Recording</button>
<button id="stopRecording" disabled>Stop Recording</button>
<br><br>
<audio id="audio" controls></audio>
<button id="playLoop">Play Reminder Loop</button>
<button id="stopLoop" style="display:none;">Stop Reminder</button>

<script>
const startRecordingBtn = document.getElementById('startRecording');
const stopRecordingBtn = document.getElementById('stopRecording');
const audioElement = document.getElementById('audio');
const playLoopBtn = document.getElementById('playLoop');
const stopLoopBtn = document.getElementById('stopLoop');

let mediaRecorder;
let recordedChunks = [];
let isLoopPlaying = false;
let loopIntervalId;

startRecordingBtn.addEventListener('click', async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);
  mediaRecorder.ondataavailable = e => {
    if (e.data.size > 0) {
      recordedChunks.push(e.data);
    }
  };
  mediaRecorder.onstop = () => {
    const blob = new Blob(recordedChunks, { type: 'audio/wav' });
    const url = URL.createObjectURL(blob);
    audioElement.src = url;
    recordedChunks = [];
    playLoopBtn.disabled = false;
    stopLoopBtn.style.display = 'inline-block';
  };
  mediaRecorder.start();
  startRecordingBtn.disabled = true;
  stopRecordingBtn.disabled = false;
});

stopRecordingBtn.addEventListener('click', () => {
  mediaRecorder.stop();
  startRecordingBtn.disabled = false;
  stopRecordingBtn.disabled = true;
});

playLoopBtn.addEventListener('click', () => {
  isLoopPlaying = true;
  playLoopBtn.disabled = true;
  stopLoopBtn.style.display = 'inline-block';
  playLoop();
});

stopLoopBtn.addEventListener('click', () => {
  clearTimeout(loopIntervalId);
  audioElement.pause();
  audioElement.currentTime = 0;
  isLoopPlaying = false;
  playLoopBtn.disabled = false;
  stopLoopBtn.style.display = 'none';
});

function playLoop() {
  if (isLoopPlaying) {
    audioElement.play();
    audioElement.addEventListener('ended', () => {
      loopIntervalId = setTimeout(() => {
        audioElement.pause();
        audioElement.currentTime = 0;
        playSilence();
      }, 20000); // 20 seconds pause at the end of playback
    });
  }
}

function playSilence() {
  setTimeout(() => {
    playLoop();
  }, 1000); // Play silence for a second before starting the loop again
}
</script>
</body>
</html>
